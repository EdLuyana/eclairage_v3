{% extends 'base.html.twig' %}

{% block title %}Journal des ventes{% endblock %}

{% block body %}
    <h1 class="mb-4">ðŸ§¾ Journal des ventes</h1>

    <form method="get" class="row g-3 mb-4">
        <div class="col-md-3">
            <label for="period" class="form-label">PÃ©riode</label>
            <select name="period" id="period" class="form-select">
                <option value="24h" {{ period == '24h' ? 'selected' }}>DerniÃ¨res 24h</option>
                <option value="1w" {{ period == '1w' ? 'selected' }}>1 semaine</option>
                <option value="1m" {{ period == '1m' ? 'selected' }}>1 mois</option>
                <option value="month" {{ period == 'month' ? 'selected' }}>Mois en cours</option>
                <option value="year" {{ period == 'year' ? 'selected' }}>AnnÃ©e en cours</option>
                <option value="all" {{ period == 'all' ? 'selected' }}>Depuis le dÃ©but</option>
            </select>
        </div>

        <div class="col-md-3">
            <label for="location" class="form-label">Magasin</label>
            <select name="location" id="location" class="form-select">
                <option value="">Tous les magasins</option>
                {% for loc in locations %}
                    <option value="{{ loc.id }}" {{ locationId == loc.id ? 'selected' }}>
                        {{ loc.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-3">
            <label for="user" class="form-label">Vendeuse</label>
            <select name="user" id="user" class="form-select">
                <option value="">Toutes les vendeuses</option>
                {% for u in users %}
                    <option value="{{ u.id }}" {{ userId == u.id ? 'selected' }}>
                        {{ u.username }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-3 align-self-end">
            <button class="btn btn-primary w-100">ðŸ”Ž Filtrer</button>
        </div>
    </form>

    <a href="{{ path('admin_export_sales_pdf', {
        period: period,
        user: userId,
        location: locationId
    }) }}" class="btn btn-outline-secondary mb-3">
        ðŸ“„ Exporter en PDF
    </a>

    <table class="table table-bordered table-striped align-middle">
        <thead class="table-light">
        <tr>
            <th>Date</th>
            <th>RÃ©fÃ©rence</th>
            <th>Taille</th>
            <th>QuantitÃ©</th>
            <th>Prix unitaire</th>
            <th>Montant</th>
            <th>Magasin</th>
            <th>Vendeuse</th>
        </tr>
        </thead>
        <tbody>
        {% set total = 0 %}
        {% for movement in movements %}
            {% set montant = movement.quantity * movement.price %}
            {% set total = total + montant %}
            <tr>
                <td>{{ movement.createdAt|date('d/m/Y H:i') }}</td>
                <td>{{ movement.product.reference }}</td>
                <td>{{ movement.size }}</td>
                <td>{{ movement.quantity }}</td>
                <td>{{ movement.price|number_format(2, '.', ' ') }} â‚¬</td>
                <td>{{ montant|number_format(2, '.', ' ') }} â‚¬</td>
                <td>{{ movement.location.name }}</td>
                <td>{{ movement.user.username }}</td>
            </tr>
        {% else %}
            <tr>
                <td colspan="8" class="text-center text-muted">Aucune vente enregistrÃ©e pour cette sÃ©lection.</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% if movements %}
        <div class="text-end fw-bold fs-5 mt-3">
            Total CA : {{ total|number_format(2, '.', ' ') }} â‚¬
        </div>
    {% endif %}
{% endblock %}
